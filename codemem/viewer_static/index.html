<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>codemem viewer</title>
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300..700;1,9..40,300..700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      (function() {
        try {
          var rawTheme = localStorage.getItem('codemem-theme') || '';
          if (!rawTheme) return;
          var mode = rawTheme.indexOf('dark') === 0 ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', mode);
          document.documentElement.setAttribute('data-color-mode', mode);
        } catch (_e) {}
      })();
    </script>
    <style>
      /* ── Design Tokens ─────────────────────────────────────── */

      :root {
        /* Surface */
        --surface-0: #faf8f5;
        --surface-1: #fff9f2;
        --surface-2: #f5efe6;
        --surface-3: #ede5d9;

        /* Text — tinted warm greys */
        --text-primary: #1a1917;
        --text-secondary: #5c5549;
        --text-tertiary: #9b9285;
        --text-inverse: #faf8f5;

        /* Accent */
        --accent: #1a6b56;
        --accent-hover: #15574a;
        --accent-subtle: rgba(26, 107, 86, 0.10);
        --accent-warm: #d4642e;
        --accent-warm-subtle: rgba(212, 100, 46, 0.12);
        --accent-cool: #2d4a7a;
        --accent-cool-subtle: rgba(45, 74, 122, 0.10);

        /* Status */
        --status-healthy: #1a6b56;
        --status-degraded: #d4642e;
        --status-attention: #b64b2f;

        /* Border & chrome */
        --border: #e8dfd3;
        --border-hover: #d4c8b8;
        --focus-ring: rgba(26, 107, 86, 0.14);
        --shadow-sm: 0 1px 3px rgba(24, 23, 18, 0.06);
        --shadow-md: 0 8px 24px rgba(24, 23, 18, 0.08);
        --shadow-lg: 0 18px 40px rgba(24, 23, 18, 0.12);

        /* Controls */
        --control-bg: rgba(26, 107, 86, 0.08);
        --control-border: rgba(26, 107, 86, 0.22);
        --control-hover-bg: rgba(26, 107, 86, 0.14);
        --control-hover-border: rgba(26, 107, 86, 0.4);
        --control-text: var(--accent);

        /* Toggles */
        --toggle-active-bg: rgba(26, 107, 86, 0.14);
        --toggle-active-text: var(--accent);
        --toggle-hover-bg: rgba(0, 0, 0, 0.04);

        /* Input */
        --input-bg: rgba(255, 255, 255, 0.7);

        /* Feed */
        --item-bg: rgba(255, 255, 255, 0.6);
        --item-hover-bg: rgba(255, 255, 255, 0.85);
        --feed-hover-border: var(--accent);

        /* Background gradients */
        --grad-1: rgba(26, 107, 86, 0.12);
        --grad-2: rgba(212, 100, 46, 0.14);
        --grad-3: rgba(45, 74, 122, 0.10);
        --body-start: #faf6ee;
        --body-mid: #f3eadc;
        --body-end: #efe3d2;
        --dot-color: rgba(0, 0, 0, 0.025);

        /* Spacing scale (4px base) */
        --sp-1: 4px;
        --sp-2: 8px;
        --sp-3: 12px;
        --sp-4: 16px;
        --sp-5: 20px;
        --sp-6: 24px;
        --sp-8: 32px;
        --sp-10: 40px;
        --sp-12: 48px;

        /* Radii */
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 20px;
        --radius-pill: 999px;

        /* Typography */
        --font-sans: "DM Sans", "Avenir Next", "Avenir", system-ui, sans-serif;
        --font-mono: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, monospace;
      }

      /* ── Dark mode ─────────────────────────────────────────── */

      @media (prefers-color-scheme: dark) {
        :root:not([data-theme="light"]) {
          --surface-0: #161514;
          --surface-1: #201f1d;
          --surface-2: #2a2826;
          --surface-3: #343230;

          --text-primary: #ede8e2;
          --text-secondary: #b5aea5;
          --text-tertiary: #7d756b;
          --text-inverse: #161514;

          --accent: #4dd4b4;
          --accent-hover: #3cc4a4;
          --accent-subtle: rgba(77, 212, 180, 0.14);
          --accent-warm: #ff9e6a;
          --accent-warm-subtle: rgba(255, 158, 106, 0.16);
          --accent-cool: #7eaaeb;
          --accent-cool-subtle: rgba(126, 170, 235, 0.14);

          --status-healthy: #4dd4b4;
          --status-degraded: #ff9e6a;
          --status-attention: #ff7a50;

          --border: #3a3735;
          --border-hover: #4a4745;
          --focus-ring: rgba(77, 212, 180, 0.18);
          --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.2);
          --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.3);
          --shadow-lg: 0 18px 40px rgba(0, 0, 0, 0.5);

          --control-bg: rgba(255, 255, 255, 0.06);
          --control-border: rgba(255, 255, 255, 0.14);
          --control-hover-bg: rgba(255, 255, 255, 0.10);
          --control-hover-border: rgba(255, 255, 255, 0.24);
          --control-text: var(--accent);

          --toggle-active-bg: rgba(77, 212, 180, 0.20);
          --toggle-active-text: var(--accent);
          --toggle-hover-bg: rgba(255, 255, 255, 0.08);

          --input-bg: rgba(60, 58, 56, 1);
          --item-bg: rgba(50, 48, 46, 1);
          --item-hover-bg: rgba(60, 58, 56, 1);

          --grad-1: rgba(77, 212, 180, 0.08);
          --grad-2: rgba(255, 158, 106, 0.08);
          --grad-3: rgba(126, 170, 235, 0.06);
          --body-start: #161514;
          --body-mid: #1b1a19;
          --body-end: #201f1d;
          --dot-color: rgba(255, 255, 255, 0.03);
        }
      }

      [data-theme="dark"] {
        --surface-0: #161514;
        --surface-1: #201f1d;
        --surface-2: #2a2826;
        --surface-3: #343230;

        --text-primary: #ede8e2;
        --text-secondary: #b5aea5;
        --text-tertiary: #7d756b;
        --text-inverse: #161514;

        --accent: #4dd4b4;
        --accent-hover: #3cc4a4;
        --accent-subtle: rgba(77, 212, 180, 0.14);
        --accent-warm: #ff9e6a;
        --accent-warm-subtle: rgba(255, 158, 106, 0.16);
        --accent-cool: #7eaaeb;
        --accent-cool-subtle: rgba(126, 170, 235, 0.14);

        --status-healthy: #4dd4b4;
        --status-degraded: #ff9e6a;
        --status-attention: #ff7a50;

        --border: #3a3735;
        --border-hover: #4a4745;
        --focus-ring: rgba(77, 212, 180, 0.18);
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.2);
        --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 18px 40px rgba(0, 0, 0, 0.5);

        --control-bg: rgba(255, 255, 255, 0.06);
        --control-border: rgba(255, 255, 255, 0.14);
        --control-hover-bg: rgba(255, 255, 255, 0.10);
        --control-hover-border: rgba(255, 255, 255, 0.24);
        --control-text: var(--accent);

        --toggle-active-bg: rgba(77, 212, 180, 0.20);
        --toggle-active-text: var(--accent);
        --toggle-hover-bg: rgba(255, 255, 255, 0.08);

        --input-bg: rgba(60, 58, 56, 1);
        --item-bg: rgba(50, 48, 46, 1);
        --item-hover-bg: rgba(60, 58, 56, 1);

        --grad-1: rgba(77, 212, 180, 0.08);
        --grad-2: rgba(255, 158, 106, 0.08);
        --grad-3: rgba(126, 170, 235, 0.06);
        --body-start: #161514;
        --body-mid: #1b1a19;
        --body-end: #201f1d;
        --dot-color: rgba(255, 255, 255, 0.03);
      }

      /* ── Reset & base ──────────────────────────────────────── */

      *, *::before, *::after { box-sizing: border-box; margin: 0; }

      body {
        font-family: var(--font-sans);
        font-size: 14px;
        line-height: 1.55;
        color: var(--text-primary);
        background:
          radial-gradient(circle at 12% 12%, var(--grad-1), transparent 45%),
          radial-gradient(circle at 82% 18%, var(--grad-2), transparent 42%),
          radial-gradient(circle at 70% 85%, var(--grad-3), transparent 40%),
          linear-gradient(180deg, var(--body-start) 0%, var(--body-mid) 65%, var(--body-end) 100%);
        min-height: 100vh;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image: radial-gradient(var(--dot-color) 1px, transparent 0);
        background-size: 20px 20px;
        opacity: 0.4;
        pointer-events: none;
        z-index: 0;
      }

      [hidden] { display: none !important; }

      /* ── Accessibility ─────────────────────────────────────── */

      .sr-only {
        position: absolute; width: 1px; height: 1px;
        padding: 0; margin: -1px; overflow: hidden;
        clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;
      }

      /* ── Header ────────────────────────────────────────────── */

      header {
        position: sticky;
        top: 0;
        z-index: 10;
        padding: var(--sp-4) var(--sp-6);
        border-bottom: 1px solid var(--border);
        background: color-mix(in srgb, var(--surface-1) 86%, transparent);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      .header-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--sp-4);
        flex-wrap: wrap;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: var(--sp-3);
        min-width: 0;
      }

      .header-brand {
        display: flex;
        align-items: center;
        gap: var(--sp-3);
      }

      .logo {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: var(--radius-sm);
        background: var(--accent-subtle);
        color: var(--accent);
        flex-shrink: 0;
      }
      .logo svg { display: block; }

      .header-title {
        font-size: 18px;
        font-weight: 600;
        letter-spacing: -0.01em;
        white-space: nowrap;
      }

      .health-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        flex-shrink: 0;
      }
      .health-dot.status-healthy { background: var(--status-healthy); box-shadow: 0 0 0 3px rgba(26, 107, 86, 0.15); }
      .health-dot.status-degraded { background: var(--status-degraded); box-shadow: 0 0 0 3px rgba(212, 100, 46, 0.15); }
      .health-dot.status-attention { background: var(--status-attention); box-shadow: 0 0 0 3px rgba(182, 75, 47, 0.15); animation: pulse 2.4s ease infinite; }

      .header-right {
        display: flex;
        align-items: center;
        gap: var(--sp-2);
      }

      .refresh-status {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        color: var(--text-tertiary);
      }

      .meta-line {
        font-size: 12px;
        color: var(--text-tertiary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 300px;
      }

      /* ── Tab bar ───────────────────────────────────────────── */

      .tab-bar {
        display: flex;
        gap: 2px;
        padding: 0 var(--sp-6);
        background: color-mix(in srgb, var(--surface-0) 60%, transparent);
        backdrop-filter: blur(8px);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 73px; /* header height */
        z-index: 9;
      }

      .tab-btn {
        position: relative;
        padding: var(--sp-3) var(--sp-4);
        border: none;
        background: transparent;
        color: var(--text-tertiary);
        font-family: var(--font-sans);
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: color 0.15s ease;
      }

      .tab-btn:hover {
        color: var(--text-primary);
      }

      .tab-btn.active {
        color: var(--accent);
        font-weight: 600;
      }

      .tab-btn.active::after {
        content: "";
        position: absolute;
        bottom: -1px;
        left: var(--sp-4);
        right: var(--sp-4);
        height: 2px;
        background: var(--accent);
        border-radius: 2px 2px 0 0;
      }

      /* ── Tab panels ────────────────────────────────────────── */

      .tab-panel {
        position: relative;
        z-index: 1;
        padding: var(--sp-6);
        max-width: 1100px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: var(--sp-5);
      }

      /* ── Cards / sections ──────────────────────────────────── */

      .card {
        background: var(--surface-1);
        border: 1px solid var(--border);
        border-radius: var(--radius-xl);
        padding: var(--sp-5);
        box-shadow: var(--shadow-md);
        animation: fadeUp 0.4s ease both;
      }

      .card h2 {
        font-size: 16px;
        font-weight: 600;
        letter-spacing: -0.01em;
        margin-bottom: var(--sp-3);
      }

      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--sp-3);
        margin-bottom: var(--sp-3);
      }

      .section-header h2 { margin-bottom: 0; }

      .section-actions {
        display: flex;
        gap: var(--sp-2);
        align-items: center;
      }

      .section-meta {
        color: var(--text-tertiary);
        font-size: 12px;
        margin-bottom: var(--sp-3);
      }

      /* ── Grid ──────────────────────────────────────────────── */

      .grid-2 {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: var(--sp-3);
      }

      .summary-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: var(--sp-5);
      }

      /* ── Stat cards ────────────────────────────────────────── */

      .stat {
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: var(--sp-3);
        background: var(--surface-2);
        display: flex;
        align-items: center;
        gap: var(--sp-3);
      }

      .stat-icon {
        width: 18px;
        height: 18px;
        flex-shrink: 0;
        stroke: var(--accent);
        opacity: 0.6;
      }

      .stat-content {
        display: flex;
        flex-direction: column;
        min-width: 0;
      }

      .stat .value {
        font-weight: 600;
        font-size: 16px;
        color: var(--accent-cool);
        line-height: 1.2;
      }

      .stat .label {
        color: var(--text-tertiary);
        font-size: 11px;
        line-height: 1.3;
      }

      .health-primary {
        border-width: 2px;
      }
      .health-primary .value { font-size: 20px; letter-spacing: 0.2px; }
      .health-primary.status-healthy .value { color: var(--status-healthy); }
      .health-primary.status-degraded .value { color: var(--status-degraded); }
      .health-primary.status-attention .value { color: var(--status-attention); }

      /* ── Buttons ───────────────────────────────────────────── */

      .settings-button {
        border: 1px solid var(--control-border);
        background: var(--control-bg);
        color: var(--control-text);
        padding: 5px 12px;
        border-radius: var(--radius-pill);
        font-size: 12px;
        font-family: var(--font-sans);
        cursor: pointer;
        transition: background 0.15s ease, border-color 0.15s ease;
        white-space: nowrap;
      }
      .settings-button:hover {
        background: var(--control-hover-bg);
        border-color: var(--control-hover-border);
      }
      .settings-button:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }

      /* ── Selects / inputs ──────────────────────────────────── */

      .project-filter,
      .theme-select {
        padding: 5px 10px;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        background: var(--input-bg);
        color: var(--text-primary);
        font-family: var(--font-sans);
        font-size: 12px;
        cursor: pointer;
        transition: border-color 0.15s ease;
      }
      .project-filter:hover, .theme-select:hover { border-color: var(--border-hover); }
      .project-filter:focus, .theme-select:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--focus-ring);
      }
      .theme-select { min-width: 150px; }

      /* ── Feed section ──────────────────────────────────────── */

      .feed-controls {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--sp-3);
        flex-wrap: wrap;
        margin-bottom: var(--sp-4);
      }

      .feed-controls-right {
        display: flex;
        align-items: center;
        gap: var(--sp-3);
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .feed-search {
        min-width: 200px;
        flex: 1;
        max-width: 400px;
        padding: 8px var(--sp-3);
        border-radius: var(--radius-md);
        border: 1px solid var(--border);
        background: var(--input-bg);
        color: var(--text-primary);
        font-family: var(--font-sans);
        font-size: 13px;
        outline: none;
        transition: border-color 0.15s ease, box-shadow 0.15s ease;
      }
      .feed-search::placeholder { color: var(--text-tertiary); }
      .feed-search:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--focus-ring); }

      .feed-toggle {
        display: inline-flex;
        gap: 2px;
        padding: 3px;
        border-radius: var(--radius-pill);
        border: 1px solid var(--border);
        background: var(--surface-2);
      }

      .toggle-button {
        border: none;
        background: transparent;
        color: var(--text-tertiary);
        font-family: var(--font-sans);
        font-size: 12px;
        padding: 4px 10px;
        border-radius: var(--radius-pill);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        transition: background 0.15s ease, color 0.15s ease;
      }
      .toggle-button:hover { background: var(--toggle-hover-bg); color: var(--text-primary); }
      .toggle-button.active { background: var(--toggle-active-bg); color: var(--toggle-active-text); font-weight: 600; }

      .feed-list {
        display: flex;
        flex-direction: column;
        gap: var(--sp-3);
      }

      /* ── Feed items ────────────────────────────────────────── */

      .feed-item {
        border: 1px solid var(--border);
        border-left: 4px solid var(--accent);
        border-radius: var(--radius-lg);
        padding: var(--sp-4) var(--sp-5);
        background: var(--surface-1);
        display: flex;
        flex-direction: column;
        gap: var(--sp-2);
        transition: transform 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;
      }
      .feed-item:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-sm);
        border-color: var(--border-hover);
      }
      .feed-item.new-item { animation: newPulse 420ms ease-out 1; }

      /* Kind border colors */
      .feed-item.feature { border-left-color: var(--accent); }
      .feed-item.change { border-left-color: var(--accent-cool); }
      .feed-item.bugfix { border-left-color: var(--accent-warm); }
      .feed-item.refactor { border-left-color: #8b5cc6; }
      .feed-item.discovery { border-left-color: #5e81ac; }
      .feed-item.decision { border-left-color: #8fadbd; }
      .feed-item.session_summary { border-left-color: #4696c8; }
      .feed-item.exploration { border-left-color: var(--text-tertiary); }

      .feed-card-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: var(--sp-3);
      }
      .feed-card-header > .feed-header { flex: 1; overflow: hidden; }

      .feed-header {
        display: flex;
        align-items: center;
        gap: var(--sp-2);
        flex-wrap: wrap;
        min-width: 0;
      }

      .feed-actions {
        display: flex;
        align-items: center;
        gap: var(--sp-2);
        flex-shrink: 0;
      }

      .feed-title {
        font-weight: 600;
        font-size: 15px;
        flex: 1;
        min-width: 0;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
        overflow-wrap: anywhere;
        word-break: break-word;
      }

      .feed-meta {
        color: var(--text-tertiary);
        font-size: 12px;
      }

      .feed-body {
        font-size: 13px;
        line-height: 1.55;
        color: var(--text-secondary);
      }
      .feed-body.clamp { display: -webkit-box; -webkit-box-orient: vertical; overflow: hidden; }
      .feed-body.clamp-3 { -webkit-line-clamp: 3; }
      .feed-body.clamp-5 { -webkit-line-clamp: 5; }
      .feed-body.facts { display: flex; flex-direction: column; gap: 6px; }
      .feed-body p { margin: 0 0 0.5em; }
      .feed-body p:last-child { margin-bottom: 0; }
      .feed-body ul, .feed-body ol { margin: 0.3em 0; padding-left: 1.3em; list-style: revert; }
      .feed-body li { margin: 0.15em 0; padding: 0; border: none; border-radius: 0; background: none; font-size: inherit; }
      .feed-body li:hover { transform: none; border-color: transparent; background: none; }
      .feed-body code { background: var(--surface-2); padding: 0.15em 0.35em; border-radius: 4px; font-family: var(--font-mono); font-size: 0.9em; }
      .feed-body pre { background: var(--surface-2); padding: 0.6em 0.8em; border-radius: var(--radius-sm); overflow-x: auto; margin: 0.5em 0; }
      .feed-body pre code { background: none; padding: 0; }
      .feed-body strong { font-weight: 600; }
      .feed-body em { font-style: italic; }
      .feed-body a { color: var(--accent); text-decoration: underline; }
      .feed-body h1, .feed-body h2, .feed-body h3, .feed-body h4 { font-size: 1em; font-weight: 600; margin: 0.6em 0 0.3em; }
      .feed-body blockquote { border-left: 3px solid var(--border); margin: 0.5em 0; padding-left: 0.8em; color: var(--text-tertiary); }

      .summary-section {
        display: flex;
        flex-direction: column;
        gap: 4px;
        padding: 6px 0;
        border-bottom: 1px solid var(--border);
      }
      .summary-section:last-child { border-bottom: none; }
      .summary-section-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-tertiary); }
      .summary-section-content { font-size: 13px; line-height: 1.5; color: var(--text-primary); }

      .feed-footer {
        display: flex;
        flex-wrap: wrap;
        gap: var(--sp-2);
        align-items: flex-start;
        justify-content: space-between;
      }
      .feed-footer-left { display: flex; flex-direction: column; gap: 6px; }
      .feed-footer-right { display: flex; align-items: center; gap: var(--sp-2); flex-shrink: 0; }

      .feed-expand {
        border: 1px solid var(--border);
        background: transparent;
        color: var(--text-tertiary);
        border-radius: var(--radius-pill);
        padding: 3px 10px;
        font-family: var(--font-sans);
        font-size: 11px;
        cursor: pointer;
        transition: background 0.15s ease, color 0.15s ease;
      }
      .feed-expand:hover { background: var(--accent-subtle); color: var(--accent); }

      .feed-tags { display: flex; flex-wrap: wrap; gap: 6px; }
      .feed-files { display: flex; flex-wrap: wrap; gap: var(--sp-2); font-size: 10px; color: var(--text-tertiary); opacity: 0.85; }
      .feed-file { white-space: nowrap; }
      .feed-age { white-space: nowrap; }

      /* ── Pills & badges ────────────────────────────────────── */

      .kind-pill {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: var(--radius-pill);
        font-size: 11px;
        font-weight: 500;
        letter-spacing: 0.2px;
        white-space: nowrap;
        background: var(--accent-subtle);
        color: var(--accent);
      }
      .kind-pill.feature { background: var(--accent-subtle); color: var(--accent); }
      .kind-pill.change { background: var(--accent-cool-subtle); color: var(--accent-cool); }
      .kind-pill.bugfix { background: var(--accent-warm-subtle); color: var(--accent-warm); }
      .kind-pill.refactor { background: rgba(139, 92, 198, 0.12); color: #8b5cc6; }
      .kind-pill.discovery { background: rgba(94, 129, 172, 0.12); color: #5e81ac; }
      .kind-pill.decision { background: rgba(143, 173, 189, 0.12); color: #6b8fa3; }
      .kind-pill.session_summary { background: rgba(70, 150, 200, 0.12); color: #4696c8; }
      .kind-pill.exploration { background: rgba(140, 140, 140, 0.12); color: var(--text-tertiary); }

      .tag-chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 2px 10px;
        border-radius: var(--radius-pill);
        background: var(--accent-cool-subtle);
        color: var(--accent-cool);
        font-size: 11px;
        font-weight: 500;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 3px 10px;
        border-radius: var(--radius-pill);
        background: var(--accent-cool-subtle);
        color: var(--accent-cool);
        font-size: 12px;
        font-weight: 600;
      }

      .pill {
        display: inline-block;
        padding: 2px 10px;
        border-radius: var(--radius-pill);
        background: var(--accent-subtle);
        color: var(--accent);
        font-size: 12px;
        font-weight: 600;
      }
      .pill.alt { background: var(--accent-warm-subtle); color: var(--accent-warm); }

      .match {
        padding: 0 2px;
        border-radius: 3px;
        background: var(--accent-subtle);
        color: inherit;
      }

      /* ── Health actions / sync actions ──────────────────────── */

      .health-actions, .sync-actions {
        display: grid;
        gap: var(--sp-2);
        margin: var(--sp-2) 0 var(--sp-3);
      }

      .health-action, .sync-action {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--sp-3);
        padding: var(--sp-3);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--surface-2);
      }

      .health-action-text, .sync-action-text { font-size: 13px; color: var(--text-primary); flex: 1; min-width: 0; }
      .health-action-command, .sync-action-command { display: block; margin-top: 2px; font-family: var(--font-mono); font-size: 12px; color: var(--text-tertiary); }
      .health-action-buttons { display: flex; gap: 6px; flex-shrink: 0; }

      /* ── Diagnostics ───────────────────────────────────────── */

      .diag-list { margin-top: var(--sp-3); display: flex; flex-direction: column; gap: var(--sp-2); }
      .diag-line { border: 1px solid var(--border); border-radius: var(--radius-md); padding: var(--sp-3); background: var(--surface-2); display: flex; justify-content: space-between; gap: var(--sp-3); }
      .diag-line .left { min-width: 0; }
      .diag-line .right { flex-shrink: 0; color: var(--text-tertiary); }

      .diag-group { border: 1px solid var(--border); border-radius: var(--radius-sm); padding: var(--sp-2) var(--sp-3); margin-top: var(--sp-3); background: var(--surface-2); }
      .diag-group summary { cursor: pointer; color: var(--text-tertiary); font-size: 13px; }

      /* ── Peers ─────────────────────────────────────────────── */

      .peer-list { display: grid; gap: var(--sp-3); }
      .peer-card { border: 1px solid var(--border); border-radius: var(--radius-lg); padding: var(--sp-4); background: var(--surface-1); display: grid; gap: var(--sp-2); }
      .peer-title { display: flex; align-items: center; justify-content: space-between; gap: var(--sp-2); }
      .peer-title strong { font-size: 15px; }
      .peer-actions { display: flex; gap: 6px; }
      .peer-actions button { border: 1px solid var(--border); background: transparent; border-radius: var(--radius-pill); padding: 5px 10px; font-family: var(--font-sans); font-size: 12px; cursor: pointer; color: var(--text-secondary); }
      .peer-actions button:hover { border-color: var(--border-hover); background: var(--surface-2); }
      .peer-meta { font-size: 13px; color: var(--text-tertiary); }
      .peer-addresses { font-family: var(--font-mono); font-size: 12px; color: var(--text-secondary); opacity: 0.7; }
      .attempts-list { margin-top: var(--sp-3); display: grid; gap: 6px; font-size: 13px; color: var(--text-tertiary); }

      /* ── Pairing ───────────────────────────────────────────── */

      .pairing-card { margin-top: var(--sp-4); border: 1px dashed var(--border); border-radius: var(--radius-lg); padding: var(--sp-4); display: grid; gap: var(--sp-3); background: var(--surface-2); }
      .pairing-body { display: grid; gap: var(--sp-3); grid-template-columns: 1.4fr 1fr; align-items: start; }
      .pairing-body pre { margin: 0; font-size: 12px; background: var(--surface-0); padding: var(--sp-3); border-radius: var(--radius-md); white-space: pre-wrap; word-break: break-all; }
      @media (max-width: 900px) { .pairing-body { grid-template-columns: 1fr; } }

      /* ── Modal ──────────────────────────────────────────────── */

      .modal-backdrop {
        position: fixed; inset: 0;
        background: rgba(25, 24, 23, 0.4);
        backdrop-filter: blur(6px);
        z-index: 20;
      }
      .modal {
        position: fixed; inset: 0;
        display: flex; align-items: center; justify-content: center;
        z-index: 21;
        padding: var(--sp-6);
      }
      @media (max-height: 720px) { .modal { align-items: flex-start; } }
      .modal-backdrop[hidden], .modal[hidden] { display: none; }

      .modal-card {
        width: min(520px, 100%);
        background: var(--surface-1);
        border: 1px solid var(--border);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
        padding: var(--sp-5);
        display: flex;
        flex-direction: column;
        gap: var(--sp-4);
        max-height: min(84vh, 720px);
        overflow: hidden;
      }
      .modal-header { display: flex; align-items: center; justify-content: space-between; gap: var(--sp-3); }
      .modal-header h2 { margin: 0; font-size: 18px; }
      .modal-close { border: none; background: transparent; color: var(--text-tertiary); cursor: pointer; font-size: 12px; font-family: var(--font-sans); }
      .modal-body { display: flex; flex-direction: column; gap: var(--sp-3); flex: 1; min-height: 0; overflow-y: auto; padding-right: 6px; }
      .modal-footer { display: flex; align-items: center; justify-content: space-between; gap: var(--sp-3); flex-shrink: 0; padding-top: var(--sp-2); border-top: 1px solid var(--border); }

      .field { display: flex; flex-direction: column; gap: 6px; font-size: 13px; }
      .field input, .field select { padding: var(--sp-2) var(--sp-3); border-radius: var(--radius-sm); border: 1px solid var(--border); background: var(--input-bg); font-family: var(--font-sans); font-size: 13px; color: var(--text-primary); }
      .settings-save {
        border: 1px solid var(--control-border);
        background: var(--control-bg);
        color: var(--control-text);
        padding: var(--sp-2) var(--sp-4);
        border-radius: var(--radius-md);
        font-family: var(--font-sans);
        font-size: 12px;
        cursor: pointer;
        transition: background 0.15s ease;
      }
      .settings-save:hover { background: var(--control-hover-bg); }
      .settings-save:disabled { opacity: 0.6; cursor: not-allowed; }
      .settings-note { color: var(--text-tertiary); font-size: 12px; }

      /* ── Utilities ─────────────────────────────────────────── */

      .small { color: var(--text-tertiary); font-size: 12px; }
      .mono { font-family: var(--font-mono); font-size: 12px; }

      /* ── Animations ────────────────────────────────────────── */

      @keyframes fadeUp {
        from { transform: translateY(8px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }

      @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 0.9; }
        50% { transform: scale(1.3); opacity: 0.5; }
      }

      @keyframes newPulse {
        0% { box-shadow: 0 0 0 rgba(26, 107, 86, 0); }
        40% { box-shadow: 0 0 0 3px var(--accent-subtle); }
        100% { box-shadow: 0 0 0 rgba(26, 107, 86, 0); }
      }

      /* ── Responsive ────────────────────────────────────────── */

      @media (max-width: 900px) {
        .tab-panel { padding: var(--sp-4); }
        .summary-row { grid-template-columns: 1fr; }
        .feed-card-header { flex-wrap: wrap; }
        .feed-actions { width: 100%; justify-content: flex-end; }
      }

      @media (max-width: 520px) {
        header { padding: var(--sp-3) var(--sp-4); }
        .tab-bar { padding: 0 var(--sp-4); }
        .modal { padding: var(--sp-3); }
        .modal-card { padding: var(--sp-4); border-radius: var(--radius-lg); }
      }

      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- ── Header ──────────────────────────────────────────── -->
    <header>
      <div class="header-row">
        <div class="header-left">
          <div class="header-brand">
            <span class="logo" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" shape-rendering="crispEdges" aria-hidden="true">
                <path d="M3 8h13v13H3z" fill="none" stroke="currentColor" stroke-width="2.8" opacity="0.18"/>
                <path d="M4.5 6.5h13v13h-13z" fill="none" stroke="currentColor" stroke-width="2.8" opacity="0.30"/>
                <path d="M6 5h13v13H6z" fill="none" stroke="currentColor" stroke-width="2.8" opacity="0.56"/>
                <path d="M7.5 3.5h13v13h-13z" fill="none" stroke="currentColor" stroke-width="2.8" opacity="0.82"/>
              </svg>
            </span>
            <span class="header-title">codemem</span>
            <span class="health-dot status-healthy" id="healthDot" title="Healthy"></span>
          </div>
          <span class="refresh-status" id="refreshStatus">refreshing…</span>
          <span class="sr-only" id="refreshAnnouncer" aria-live="polite"></span>
        </div>
        <div class="header-right">
          <span class="meta-line" id="metaLine"></span>
          <select class="project-filter" id="projectFilter" aria-label="Project filter">
            <option value="">All Projects</option>
          </select>
          <label class="sr-only" for="themeSelect">Viewer theme</label>
          <select class="theme-select" id="themeSelect" aria-label="Viewer theme"></select>
          <button class="settings-button" id="settingsButton">Settings</button>
        </div>
      </div>
    </header>

    <!-- ── Tab bar ─────────────────────────────────────────── -->
    <nav class="tab-bar" aria-label="Main navigation">
      <button class="tab-btn active" id="tabBtn-feed">Feed</button>
      <button class="tab-btn" id="tabBtn-health">Health</button>
      <button class="tab-btn" id="tabBtn-sync">Sync</button>
    </nav>

    <!-- ── Settings modal ──────────────────────────────────── -->
    <div class="modal-backdrop" id="settingsBackdrop" hidden></div>
    <div class="modal" id="settingsModal" hidden role="dialog" aria-modal="true" aria-labelledby="settingsTitle" aria-describedby="settingsDescription" tabindex="-1">
      <div class="modal-card">
        <div class="modal-header">
          <h2 id="settingsTitle">Observer settings</h2>
          <button class="modal-close" id="settingsClose" aria-label="Close settings">close</button>
        </div>
        <div class="modal-body">
          <div class="small" id="settingsDescription">Update observer and sync defaults for this viewer.</div>
          <div class="field">
            <label for="observerProvider">Observer provider</label>
            <select id="observerProvider"><option value="">auto (default)</option></select>
            <div class="small">Leave blank to use defaults.</div>
          </div>
          <div class="field">
            <label for="observerModel">Observer model</label>
            <input id="observerModel" placeholder="leave empty for default" />
            <div class="small">Override the observer model.</div>
          </div>
          <div class="field">
            <label for="observerMaxChars">Observer max chars</label>
            <input id="observerMaxChars" type="number" min="1" />
            <div class="small" id="observerMaxCharsHint"></div>
          </div>
          <div class="field">
            <label for="packObservationLimit">Pack observation limit</label>
            <input id="packObservationLimit" type="number" min="1" />
            <div class="small">Default number of observations to include in a pack.</div>
          </div>
          <div class="field">
            <label for="packSessionLimit">Pack session limit</label>
            <input id="packSessionLimit" type="number" min="1" />
            <div class="small">Default number of session summaries to include in a pack.</div>
          </div>
          <div class="field"><label>Sync settings</label><div class="small">Configure peer sync.</div></div>
          <div class="field"><label for="syncEnabled">Sync enabled</label><input id="syncEnabled" type="checkbox" /></div>
          <div class="field"><label for="syncHost">Sync host</label><input id="syncHost" placeholder="127.0.0.1" /></div>
          <div class="field"><label for="syncPort">Sync port</label><input id="syncPort" type="number" min="1" /></div>
          <div class="field"><label for="syncInterval">Sync interval (seconds)</label><input id="syncInterval" type="number" min="10" /></div>
          <div class="field"><label for="syncMdns">mDNS discovery</label><input id="syncMdns" type="checkbox" /></div>
          <div class="small mono" id="settingsPath"></div>
          <div class="small" id="settingsEffective"></div>
          <div class="settings-note" id="settingsOverrides">Environment variables override file settings.</div>
        </div>
        <div class="modal-footer">
          <div class="small" id="settingsStatus">Ready</div>
          <button class="settings-save" id="settingsSave">Save</button>
        </div>
      </div>
    </div>

    <!-- ── Tab: Feed ───────────────────────────────────────── -->
    <div class="tab-panel" id="tab-feed">
      <div class="feed-controls">
        <div class="section-meta" id="feedMeta">Loading memories…</div>
        <div class="feed-controls-right">
          <input class="feed-search" id="feedSearch" placeholder="Search title, body, tags…" />
          <div class="feed-toggle" id="feedTypeToggle">
            <button class="toggle-button" data-filter="all">All</button>
            <button class="toggle-button" data-filter="observations">Observations</button>
            <button class="toggle-button" data-filter="summaries">Summaries</button>
          </div>
        </div>
      </div>
      <div class="feed-list" id="feedList"></div>
    </div>

    <!-- ── Tab: Health ─────────────────────────────────────── -->
    <div class="tab-panel" id="tab-health" hidden>
      <div class="card" style="animation-delay: 0s">
        <div class="section-header">
          <h2>System health</h2>
        </div>
        <div class="section-meta" id="healthMeta">Assessing health signals…</div>
        <div class="health-actions" id="healthActions"></div>
        <div class="grid-2" id="healthGrid"></div>
      </div>

      <div class="summary-row">
        <div class="card" style="animation-delay: 0.05s">
          <h2>Stats</h2>
          <div class="grid-2" id="statsGrid"></div>
        </div>
        <div class="card" style="animation-delay: 0.1s">
          <h2>Current session</h2>
          <div class="section-meta" id="sessionMeta">No injections yet</div>
          <div class="grid-2" id="sessionGrid"></div>
        </div>
      </div>
    </div>

    <!-- ── Tab: Sync ───────────────────────────────────────── -->
    <div class="tab-panel" id="tab-sync" hidden>
      <div class="card">
        <div class="section-header">
          <h2>Sync</h2>
          <div class="section-actions">
            <button class="settings-button" id="syncPairingToggle">Pair</button>
            <button class="settings-button" id="syncNowButton">Sync now</button>
          </div>
        </div>
        <div class="section-meta" id="syncMeta">Loading sync status…</div>
        <div class="sync-actions" id="syncActions"></div>
        <div class="grid-2" id="syncStatusGrid"></div>

        <div class="pairing-card" id="syncPairing" hidden>
          <div class="peer-title">
            <strong>Pairing command</strong>
            <div class="peer-actions"><button id="pairingCopy">Copy command</button></div>
          </div>
          <div class="pairing-body">
            <pre id="pairingPayload" style="user-select:all">Loading…</pre>
          </div>
          <div class="peer-meta" id="pairingHint">Copy and run on the other device. Use --include/--exclude to control which projects sync.</div>
        </div>
      </div>

      <div class="card" style="animation-delay: 0.05s">
        <h2>Peers</h2>
        <div class="peer-list" id="syncPeers"></div>
      </div>

      <div class="card" style="animation-delay: 0.1s">
        <h2>Recent sync attempts</h2>
        <div class="attempts-list" id="syncAttempts"></div>
      </div>

      <div class="section-meta" style="text-align:right;">
        <label class="small" style="display:inline-flex;align-items:center;gap:8px;">
          <input id="syncRedact" type="checkbox" checked />
          Redact sensitive details
        </label>
      </div>
    </div>

    <script src="/assets/app.js"></script>
  </body>
</html>
